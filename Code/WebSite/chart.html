<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" href="img/icon.png">
  <title>Cyber Cherry Tomatoes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css">
  <link rel="stylesheet" href="milligram.css">
</head>
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
<script
  src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<body>
  <h1>üçí Cyber Cherry Tomatoes are growing üçÖ</h1>
  <hr>
  <div class="flex-container">
    <div class="myCanvas"><canvas id="myChart"></canvas></div>
    <button onclick="location.href='index.php';">Back</button>
  </div>

  <script>
    d3.csv('moisture.csv').then(makeChart);
    Chart.defaults.color = '#f4f5f6';
    function makeChart(moistureCharts) {
      var chartlabels = moistureCharts.map(function (d) { return (((new Date(d.time)))) });
      var moisture_data = moistureCharts.map(function (d) { return (map(d.moisture,832,530,0,100))});
      var battery_data = moistureCharts.map(function (d) { return d.battery * 2 * 3.3 / 1024.0 });
      var temperature_data = moistureCharts.map(function (d) { return map(d.temperature,294,305,22,28)});
      var chart = new Chart("myChart", {
        type: "line",
        data: {
          labels: chartlabels,
          datasets: [{
            yAxisID: 'yAxis1',
            label: "Moisture",
            data: moisture_data,
            borderColor: 'rgb(43, 68, 199)',
            cubicInterpolationMode: 'monotone'
          },
          {
            label: "Battery Level",
            yAxisID: 'yAxis2',
            data: battery_data,
            borderColor: 'rgb(235, 252, 26)',
            cubicInterpolationMode: 'monotone'
          },
          {
            label: "Temperature Level",
            yAxisID: 'yAxis3',
            data: temperature_data,
            borderColor: 'rgb(255, 77, 26)',
            cubicInterpolationMode: 'monotone'
          }]
        },
        options: {
          scales: {
            x: {
              type: 'time',
              time: {
                unit: 'day',
                displayFormats: {
                  day: 'dd/MM - HH:mm',
                }
              }
            },
            yAxis1: {
              title: {
                text: 'Moisture (in %)',
                display: true,
                color: 'rgb(43, 68, 199)',
              },
              type: 'linear',
              position: 'left',
              ticks: {
                color: 'rgb(43, 68, 199)',

              }
            },
            yAxis2: {
              title: {
                text: 'Voltage Battery (in V)',
                display: true,
                color: 'rgb(235, 252, 26)'

              },
              type: 'linear',
              position: 'right',
              ticks: {
                color: 'rgb(235, 252, 26)'
              }
            },
            yAxis3: {
              title: {
                text: 'Temperature (in ¬∞C)',
                display: true,
                color: 'rgb(255, 77, 26)'

              },
              type: 'linear',
              position: 'left',
              ticks: {
                color: 'rgb(255, 77, 26)'
              }
            }
          }
        }
      })
    }
    function map(x, in_min, in_max, out_min, out_max) {
      return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }
  </script>
</body>

</html>